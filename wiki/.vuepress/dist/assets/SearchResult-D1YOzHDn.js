import{g as X,u as Z,h as O,i as ee,j as se,t as ae,k as le,l as D,m as C,n as a,p as te,q as U,s as re,R as I,v as ie,x as ue,y as ce,z as ne,A as oe,B as b,C as M,D as he,E as ve,F as me,G as de,H as pe,I as ye,J as ge,K as Y,L as He,M as x}from"./app-Dj986d04.js";const fe=["/","/docs/characterline.html","/docs/","/docs/timeline.html","/docs/world/characters/","/docs/world/characters/CCO/","/docs/world/characters/divineproxy/","/docs/world/characters/superhero/111.html","/docs/world/characters/superhero/character-EtherealKnight.html","/docs/world/characters/superhero/character-HearTone.html","/docs/world/characters/superhero/character-Illustra.html","/docs/world/characters/superhero/character-M-A-Y.html","/docs/world/characters/superhero/character-Scourge.html","/docs/world/characters/superhero/character-StrikeClock.html","/docs/world/characters/superhero/character-WizardHope.html","/docs/world/characters/superhero/","/404.html"],ke="SLIMSEARCH_QUERY_HISTORY",y=Y(ke,[]),Re=()=>{const{queryHistoryCount:t}=x;return{enabled:t>0,queryHistories:y,addQueryHistory:u=>{y.value=Array.from(new Set([u,...y.value.slice(0,t-1)]))},removeQueryHistory:u=>{y.value=[...y.value.slice(0,u),...y.value.slice(u+1)]}}},A=t=>fe[t.id]+("anchor"in t?`#${t.anchor}`:""),Ce="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=x,g=Y(Ce,[]),xe=()=>({enabled:j>0,resultHistories:g,addResultHistory:i=>{{const u={link:A(i),display:i.display};"header"in i&&(u.header=i.header),g.value=[u,...g.value.slice(0,j-1)]}},removeResultHistory:i=>{g.value=[...g.value.slice(0,i),...g.value.slice(i+1)]}}),Qe=t=>{const i=he(),u=O(),Q=ve(),c=D(0),H=C(()=>c.value>0),h=me([]);return de(()=>{const{search:S,terminate:m}=pe(),f=ye(d=>{const{resultsFilter:q=l=>l,querySplitter:p,suggestionsFilter:E,...r}=i.value;d?(c.value+=1,S(d,u.value,r).then(l=>q(l,d,u.value,Q.value)).then(l=>{c.value-=1,h.value=l}).catch(l=>{console.warn(l),c.value-=1,c.value||(h.value=[])})):h.value=[]},x.searchDelay-x.suggestDelay,{maxWait:5e3});U([t,u],([d])=>{f(d.join(" "))},{immediate:!0}),ge(()=>{m()})}),{isSearching:H,results:h}};var qe=X({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:i}){const u=Z(),Q=O(),c=ee(se),{addQueryHistory:H,queryHistories:h,removeQueryHistory:S}=Re(),{resultHistories:m,addResultHistory:f,removeResultHistory:d}=xe(),q=ae(t,"queries"),{results:p,isSearching:E}=Qe(q),r=le({isQuery:!0,index:0}),l=D(0),v=D(0),T=C(()=>h.value.length>0||m.value.length>0),w=C(()=>p.value.length>0),L=C(()=>p.value[l.value]||null),P=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?m.value.length-1:h.value.length-1):r.index=s-1},_=()=>{const{isQuery:e,index:s}=r;s===(e?h.value.length-1:m.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},z=()=>{l.value=l.value>0?l.value-1:p.value.length-1,v.value=L.value.contents.length-1},B=()=>{l.value=l.value<p.value.length-1?l.value+1:0,v.value=0},K=()=>{v.value<L.value.contents.length-1?v.value+=1:B()},W=()=>{v.value>0?v.value-=1:z()},$=e=>e.map(s=>He(s)?s:a(s[0],s[1])),G=e=>{if(e.type==="customField"){const s=ne[e.index]||"$content",[n,R=""]=oe(s)?s[Q.value].split("$content"):s.split("$content");return e.display.map(o=>a("div",$([n,...o,R])))}return e.display.map(s=>a("div",$(s)))},k=()=>{l.value=0,v.value=0,i("updateQuery",""),i("close")},J=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},c.value.queryHistory),h.value.map((e,s)=>a("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{i("updateQuery",e)}},[a(b,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:n=>{n.preventDefault(),n.stopPropagation(),S(s)}})]))])),V=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},c.value.resultHistory),m.value.map((e,s)=>a(I,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{k()}},()=>[a(b,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(n=>$(n)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:n=>{n.preventDefault(),n.stopPropagation(),d(s)}})]))]));return te("keydown",e=>{if(t.isFocusing){if(w.value){if(e.key==="ArrowUp")W();else if(e.key==="ArrowDown")K();else if(e.key==="Enter"){const s=L.value.contents[v.value];H(t.queries.join(" ")),f(s),u.push(A(s)),k()}}else if(e.key==="ArrowUp")P();else if(e.key==="ArrowDown")_();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(i("updateQuery",h.value[s]),e.preventDefault()):(u.push(m.value[s].link),k())}}}),U([l,v],()=>{document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active")?.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:t.queries.length?!w.value:!T.value}],id:"slimsearch-results"},t.queries.length?E.value?a(re,{hint:c.value.searching}):w.value?a("ul",{class:"slimsearch-result-list"},p.value.map(({title:e,contents:s},n)=>{const R=l.value===n;return a("li",{class:["slimsearch-result-list-item",{active:R}]},[a("div",{class:"slimsearch-result-title"},e||c.value.defaultTitle),s.map((o,N)=>{const F=R&&v.value===N;return a(I,{to:A(o),class:["slimsearch-result-item",{active:F,"aria-selected":F}],onClick:()=>{H(t.queries.join(" ")),f(o),k()}},()=>[o.type==="text"?null:a(o.type==="title"?ie:o.type==="heading"?ue:ce,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[o.type==="text"&&o.header?a("div",{class:"content-header"},o.header):null,a("div",G(o))])])})])})):c.value.emptyResult:T.value?[J(),V()]:c.value.emptyHistory)}});export{qe as default};
